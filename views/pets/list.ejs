<%- include('../partials/header', { title: 'My Pets' }) %>
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>My Virtual Pets üêæ</h1>
        <div>
            <a href="/pets/create" class="btn btn-primary me-2">‚ûï Adopt New Pet</a>
            <a href="/encyclopedia" class="btn btn-outline-info me-2">üìö Encyclopedia</a>
            <a href="/petworld" class="btn btn-outline-success">üåç Pet World</a>
        </div>
    </div>

    <% if (typeof error !== 'undefined' && error) { %>
        <div class="alert alert-danger"><%= error %></div>
    <% } %>

    <% if (typeof pets === 'undefined' || pets.length === 0) { %>
        <div class="text-center py-5">
            <div class="empty-state">
                <h3>üêæ No pets yet!</h3>
                <p class="text-muted mb-4">Adopt your first virtual pet to start the adventure</p>
                <a href="/pets/create" class="btn btn-primary btn-lg me-3">Adopt First Pet</a>
                <a href="/encyclopedia" class="btn btn-outline-info">View Pet Encyclopedia</a>
            </div>
        </div>
    <% } else { %>
        <div class="row">
            <% pets.forEach(pet => { %>
            <div class="col-md-4 mb-4">
                <div class="card h-100 pet-card" style="border: 3px solid <%= pet.rarityColor %>; border-radius: 15px;">
                    <div class="card-body text-center">
                        <!-- Pet Image with Rarity Border -->
                        <div class="pet-image-container mb-3">
                            <!-- UPDATED: Image with accessory -->
                            <img src="/images/<%= pet.species %><%= pet.accessory === 'Bow' ? '_bow' : pet.accessory === 'Hat' ? '_hat' : '' %>.png" 
     alt="<%= pet.species %>" 
     class="pet-image">
                        </div>
                        
                        <h5 class="card-title">
                            <% 
                                const speciesEmoji = {
                                    'dragon': 'üêâ',
                                    'cat': 'üê±',
                                    'dog': 'üê∂',
                                    'rat': 'üêÄ',
                                    'elf': 'üßù',
                                    'robot': 'ü§ñ',
                                    'wolf': 'üê∫',
                                    'deer': 'ü¶å',
                                    'duck': 'ü¶Ü',
                                    'bear': 'üêª'
                                };
                            %>
                            <%= speciesEmoji[pet.species] || 'üêæ' %> <%= pet.name %>
                        </h5>
                        <h6 class="card-subtitle mb-2 text-muted">
                            <span class="badge" style="background-color: <%= pet.rarityColor %>; color: white;">
                                <%= pet.rarity %>
                            </span>
                            <%= pet.species.charAt(0).toUpperCase() + pet.species.slice(1) %>
                        </h6>
                        
                        <!-- UPDATED: Single trait display -->
                        <div class="mb-2">
                            <span class="badge bg-primary">
                                <strong>Trait:</strong> <%= pet.trait || 'None' %>
                            </span>
                        </div>
                        
                        <!-- NEW: Accessory display -->
                        <% if (pet.accessory && pet.accessory !== 'None') { %>
                            <div class="mb-2">
                                <span class="badge bg-success">
                                    <% if (pet.accessory === 'Bow') { %>
                                        üéÄ <%= pet.accessory %>
                                    <% } else if (pet.accessory === 'Hat') { %>
                                        üé© <%= pet.accessory %>
                                    <% } else { %>
                                        <%= pet.accessory %>
                                    <% } %>
                                </span>
                            </div>
                        <% } %>
                        
                        <!-- Status bars -->
                        <div class="pet-status mt-3">
                            <div class="mb-2">
                                <small>Hunger: <%= pet.stats.hunger %>/100</small>
                                <div class="progress mb-1">
                                    <div class="progress-bar bg-<%= pet.stats.hunger > 50 ? 'success' : 'warning' %>" 
                                         style="width: <%= pet.stats.hunger %>%"></div>
                                </div>
                            </div>
                            <div class="mb-2">
                                <small>Happiness: <%= pet.stats.happiness %>/100</small>
                                <div class="progress mb-1">
                                    <div class="progress-bar bg-<%= pet.stats.happiness > 50 ? 'success' : 'warning' %>" 
                                         style="width: <%= pet.stats.happiness %>%"></div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <small>Energy: <%= pet.stats.energy %>/100</small>
                                <div class="progress mb-1">
                                    <div class="progress-bar bg-<%= pet.stats.energy > 50 ? 'success' : 'warning' %>" 
                                         style="width: <%= pet.stats.energy %>%"></div>
                                </div>
                            </div>
                        </div>

                        <% if (pet.needsCare && pet.needsCare()) { %>
                            <div class="alert alert-warning py-2">
                                <small>‚ö†Ô∏è Needs care!</small>
                            </div>
                        <% } %>
                    </div>
                    <div class="card-footer text-center">
                        <a href="/pets/<%= pet._id %>" class="btn btn-outline-primary btn-sm">View Details</a>
                        <form action="/pets/<%= pet._id %>/delete" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-outline-danger btn-sm" 
                                    onclick="return confirm('Are you sure you want to release <%= pet.name %>?')">
                                Release
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            <% }) %>
        </div>
    <% } %>
</div>

<style>
.pet-image-container {
    display: flex;
    justify-content: center;
    align-items: center;
}

.pet-image {
    width: 120px;
    height: 120px;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.pet-image:hover {
    transform: scale(1.1);
}

.pet-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.pet-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}
</style>

<%- include('../partials/footer', { dbStatus: typeof dbStatus !== 'undefined' ? dbStatus : 'Connected' }) %>
